{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "mappings/explanatory-note-01.05",
  "title": "JSON to XML Mapping для Пояснительной записки v01.05",
  "description": "Маппинг между JSON формой и XML структурой согласно XSD схеме Минстроя",

  "version": "01.05",
  "xmlNamespace": "http://minstroyrf.gov.ru/schemas/explanatorynote/01.05",
  "rootElement": "ExplanatoryNote",

  "mappings": {
    "metadata.explanatoryNoteNumber": {
      "xmlPath": "ExplanatoryNote/ExplanatoryNoteNumber",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "metadata.explanatoryNoteYear": {
      "xmlPath": "ExplanatoryNote/ExplanatoryNoteYear",
      "xmlType": "integer",
      "required": true,
      "transformer": null
    },
    "metadata.schemaVersion": {
      "xmlPath": "ExplanatoryNote/@SchemaVersion",
      "xmlType": "string",
      "required": true,
      "transformer": null,
      "attribute": true
    },
    "issueAuthor.name": {
      "xmlPath": "ExplanatoryNote/IssueAuthor/Organization/OrganizationName",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "issueAuthor.inn": {
      "xmlPath": "ExplanatoryNote/IssueAuthor/Organization/INN",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "issueAuthor.ogrn": {
      "xmlPath": "ExplanatoryNote/IssueAuthor/Organization/OGRN",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "issueAuthor.address": {
      "xmlPath": "ExplanatoryNote/IssueAuthor/Organization/LegalAddress",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "issueAuthor.sroNumber": {
      "xmlPath": "ExplanatoryNote/IssueAuthor/Organization/SRONumber",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "signers.chiefProjectEngineer.fullName": {
      "xmlPath": "ExplanatoryNote/Signers/ChiefProjectEngineer/FullName",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "signers.chiefProjectEngineer.snils": {
      "xmlPath": "ExplanatoryNote/Signers/ChiefProjectEngineer/SNILS",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "signers.chiefProjectEngineer.noprizNumber": {
      "xmlPath": "ExplanatoryNote/Signers/ChiefProjectEngineer/NOPRIZNumber",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "signers.chiefProjectEngineer.position": {
      "xmlPath": "ExplanatoryNote/Signers/ChiefProjectEngineer/Position",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "signers.chiefProjectArchitect.fullName": {
      "xmlPath": "ExplanatoryNote/Signers/ChiefProjectArchitect/FullName",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "signers.chiefProjectArchitect.snils": {
      "xmlPath": "ExplanatoryNote/Signers/ChiefProjectArchitect/SNILS",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "signers.chiefProjectArchitect.position": {
      "xmlPath": "ExplanatoryNote/Signers/ChiefProjectArchitect/Position",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "developer.name": {
      "xmlPath": "ExplanatoryNote/Developer/Organization/OrganizationName",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "developer.inn": {
      "xmlPath": "ExplanatoryNote/Developer/Organization/INN",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "developer.ogrn": {
      "xmlPath": "ExplanatoryNote/Developer/Organization/OGRN",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "developer.address": {
      "xmlPath": "ExplanatoryNote/Developer/Organization/LegalAddress",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "projectDecisionDocuments": {
      "xmlPath": "ExplanatoryNote/ProjectDecisionDocuments/Document",
      "xmlType": "array",
      "required": true,
      "arrayItemMapping": {
        "name": "Name",
        "number": "DocNumber",
        "date": "DocDate"
      },
      "transformer": null
    },
    "designerAssurance": {
      "xmlPath": "ExplanatoryNote/DesignerAssurance",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "nonIndustrialObject.objectID": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/@ObjectID",
      "xmlType": "string",
      "required": true,
      "transformer": null,
      "attribute": true
    },
    "nonIndustrialObject.placement": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/@Placement",
      "xmlType": "string",
      "required": true,
      "transformer": null,
      "attribute": true
    },
    "nonIndustrialObject.generalInfo.projectName": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/Name",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "nonIndustrialObject.generalInfo.functions.functionsClass": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/Functions/FunctionsClass",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "nonIndustrialObject.generalInfo.functions.functionsNote": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/Functions/FunctionsNote",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "nonIndustrialObject.generalInfo.functionsFeatures": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/FunctionsFeatures",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "nonIndustrialObject.generalInfo.fireDangerCategory": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/FireDangerCategory",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "nonIndustrialObject.generalInfo.peoplePermanentStay": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/PeoplePermanentStay",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "nonIndustrialObject.generalInfo.responsibilityLevel": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/ResponsibilityLevel",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "nonIndustrialObject.generalInfo.powerIndicator": {
      "xmlPath": "ExplanatoryNote/NonIndustrialObject/PowerIndicator",
      "xmlType": "array",
      "required": true,
      "arrayItemMapping": {
        "name": "TEI/Name",
        "measure": "TEI/Measure",
        "value": "TEI/Value",
        "oldValue": "TEI/OldValue"
      },
      "transformer": null
    },
    "generalInfo.documentNumber": {
      "xmlPath": "ExplanatoryNote/GeneralInfo/DocNumber",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "generalInfo.documentDate": {
      "xmlPath": "ExplanatoryNote/GeneralInfo/DocDate",
      "xmlType": "date",
      "required": true,
      "transformer": "formatDate"
    },
    "generalInfo.projectName": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/ObjectName",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "generalInfo.projectStage": {
      "xmlPath": "ExplanatoryNote/GeneralInfo/ProjectStage",
      "xmlType": "enum",
      "required": false,
      "transformer": null,
      "enumMapping": {
        "П": "P",
        "Р": "W",
        "РД": "WD"
      }
    },
    "objectInfo.objectType": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/ObjectType",
      "xmlType": "enum",
      "required": true,
      "transformer": null,
      "enumMapping": {
        "linear": "1",
        "nonlinear": "2"
      }
    },
    "objectInfo.constructionAddress.region": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/ConstructionAddress/RegionCode",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "objectInfo.constructionAddress.locality": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/ConstructionAddress/Locality",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "objectInfo.constructionAddress.street": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/ConstructionAddress/Street",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "objectInfo.constructionAddress.house": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/ConstructionAddress/House",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "objectInfo.constructionAddress.cadastralNumber": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/LandPlot/CadastralNumber",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "objectInfo.buildingPurpose": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/BuildingPurpose",
      "xmlType": "enum",
      "required": false,
      "transformer": null,
      "enumMapping": {
        "residential": "01",
        "public": "02",
        "industrial": "03",
        "agricultural": "04",
        "transport": "05"
      }
    },
    "objectInfo.technicalParameters.totalArea": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/TechnicalIndicators/TotalArea",
      "xmlType": "decimal",
      "required": false,
      "transformer": "formatDecimal",
      "unit": "м²",
      "unitCode": "055"
    },
    "objectInfo.technicalParameters.buildingHeight": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/TechnicalIndicators/BuildingHeight",
      "xmlType": "decimal",
      "required": false,
      "transformer": "formatDecimal",
      "unit": "м",
      "unitCode": "006"
    },
    "objectInfo.technicalParameters.floors": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/TechnicalIndicators/Floors",
      "xmlType": "integer",
      "required": false,
      "transformer": null
    },
    "objectInfo.technicalParameters.undergroundFloors": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/TechnicalIndicators/UndergroundFloors",
      "xmlType": "integer",
      "required": false,
      "transformer": null
    },
    "objectInfo.technicalParameters.capacity": {
      "xmlPath": "ExplanatoryNote/ObjectInfo/TechnicalIndicators/Capacity",
      "xmlType": "integer",
      "required": false,
      "transformer": null,
      "unit": "мест",
      "unitCode": "642"
    },
    "contractor.name": {
      "xmlPath": "ExplanatoryNote/Participants/Contractor/OrganizationName",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "contractor.inn": {
      "xmlPath": "ExplanatoryNote/Participants/Contractor/INN",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "contractor.address": {
      "xmlPath": "ExplanatoryNote/Participants/Contractor/LegalAddress",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "contractor.contact.phone": {
      "xmlPath": "ExplanatoryNote/Participants/Contractor/ContactInfo/Phone",
      "xmlType": "string",
      "required": false,
      "transformer": "normalizePhone"
    },
    "contractor.contact.email": {
      "xmlPath": "ExplanatoryNote/Participants/Contractor/ContactInfo/Email",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "designer.name": {
      "xmlPath": "ExplanatoryNote/Participants/Designer/OrganizationName",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "designer.inn": {
      "xmlPath": "ExplanatoryNote/Participants/Designer/INN",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "designer.sroNumber": {
      "xmlPath": "ExplanatoryNote/Participants/Designer/SRONumber",
      "xmlType": "string",
      "required": true,
      "transformer": null
    },
    "designer.chiefEngineer.fullName": {
      "xmlPath": "ExplanatoryNote/Participants/Designer/ChiefEngineer/FullName",
      "xmlType": "string",
      "required": false,
      "transformer": null
    },
    "designer.chiefEngineer.position": {
      "xmlPath": "ExplanatoryNote/Participants/Designer/ChiefEngineer/Position",
      "xmlType": "string",
      "required": false,
      "transformer": null
    }
  },

  "transformers": {
    "formatDate": {
      "description": "Конвертация даты из ISO 8601 в формат XML (YYYY-MM-DD)",
      "function": "formatDate"
    },
    "formatDecimal": {
      "description": "Форматирование числа с точностью до 2 знаков",
      "function": "formatDecimal"
    },
    "normalizePhone": {
      "description": "Нормализация телефонного номера",
      "function": "normalizePhone"
    }
  },

  "xmlTemplate": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<ExplanatoryNote xmlns=\"http://minstroyrf.gov.ru/schemas/explanatorynote/01.05\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://minstroyrf.gov.ru/schemas/explanatorynote/01.05 explanatorynote-01-05.xsd\" SchemaVersion=\"01.05\">\n  <ExplanatoryNoteNumber><!-- generated --></ExplanatoryNoteNumber>\n  <ExplanatoryNoteYear><!-- generated --></ExplanatoryNoteYear>\n  <IssueAuthor>\n    <Organization><!-- generated --></Organization>\n  </IssueAuthor>\n  <Signers>\n    <ChiefProjectEngineer><!-- generated --></ChiefProjectEngineer>\n  </Signers>\n  <Developer>\n    <Organization><!-- generated --></Organization>\n  </Developer>\n  <ProjectDecisionDocuments><!-- generated --></ProjectDecisionDocuments>\n  <DesignerAssurance><!-- generated --></DesignerAssurance>\n  <NonIndustrialObject ObjectID=\"<!-- generated -->\" Placement=\"<!-- generated -->\">\n    <!-- Generated content -->\n  </NonIndustrialObject>\n</ExplanatoryNote>"
}
