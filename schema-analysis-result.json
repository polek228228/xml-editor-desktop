{
  "analysis_date": "2025-10-06",
  "xsd_version": "01.05",
  "json_schema_version": "01.05",

  "missingFields": [
    {
      "section": "root",
      "field": "ExplanatoryNoteNumber",
      "xsdPath": "ExplanatoryNote/ExplanatoryNoteNumber",
      "type": "string",
      "required": true,
      "description": "Шифр пояснительной записки",
      "example": "ПЗ-123/2025"
    },
    {
      "section": "root",
      "field": "ExplanatoryNoteYear",
      "xsdPath": "ExplanatoryNote/ExplanatoryNoteYear",
      "type": "integer",
      "required": true,
      "description": "Год составления пояснительной записки",
      "example": 2025,
      "validation": "tYear type (4-digit year)"
    },
    {
      "section": "root",
      "field": "IssueAuthor",
      "xsdPath": "ExplanatoryNote/IssueAuthor",
      "type": "object",
      "required": true,
      "description": "Сведения о лице, подготовившем пояснительную записку - генеральном проектировщике",
      "structure": "tAuthor (Organization | ForeignOrganization | IP)"
    },
    {
      "section": "root",
      "field": "Signers",
      "xsdPath": "ExplanatoryNote/Signers",
      "type": "object",
      "required": true,
      "description": "Сведения о лицах, подписавших документацию",
      "structure": {
        "ChiefProjectEngineer": "required - Главный инженер проекта",
        "ChiefProjectArchitect": "optional - Главный архитектор проекта",
        "Signer": "array - Лица, подписавшие документацию"
      }
    },
    {
      "section": "root",
      "field": "Developer",
      "xsdPath": "ExplanatoryNote/Developer",
      "type": "object",
      "required": true,
      "description": "Сведения о застройщике (choice: один из Developer или TechnicalCustomer обязателен)",
      "structure": "Organization | ForeignOrganization | IP | Person"
    },
    {
      "section": "root",
      "field": "ProjectDecisionDocuments",
      "xsdPath": "ExplanatoryNote/ProjectDecisionDocuments",
      "type": "array",
      "required": true,
      "description": "Перечень документов, на основании которых принято решение о подготовке проектной документации"
    },
    {
      "section": "root",
      "field": "ProjectInitialDocuments",
      "xsdPath": "ExplanatoryNote/ProjectInitialDocuments",
      "type": "array",
      "required": true,
      "description": "Перечень исходно-разрешительной документации, кроме отчетной документации по результатам инженерных изысканий"
    },
    {
      "section": "root",
      "field": "DesignerAssurance",
      "xsdPath": "ExplanatoryNote/DesignerAssurance",
      "type": "string",
      "required": true,
      "description": "Заверение проектной организации о том, что проектная документация разработана в соответствии с требованиями",
      "fieldType": "richtext"
    },
    {
      "section": "generalInfo",
      "field": "address",
      "xsdPath": "NonIndustrialObject/Address",
      "type": "object",
      "required": true,
      "description": "Почтовый (строительный) адрес объекта капитального строительства",
      "structure": {
        "Country": "optional - Страна",
        "Region": "required - Код субъекта РФ (tRegionsRF)",
        "District": "optional - Наименование района",
        "City": "optional - Город",
        "Settlement": "optional - Населенный пункт",
        "Street": "optional - Улица",
        "House": "optional - Дом",
        "Building": "optional - Корпус",
        "Structure": "optional - Строение"
      },
      "note": "В JSON Schema используется projectPurpose вместо Address"
    },
    {
      "section": "generalInfo",
      "field": "constructionType",
      "xsdPath": "NonIndustrialObject/ConstructionType",
      "type": "integer",
      "required": true,
      "description": "Вид работ (tConstructionType)",
      "enum": [1, 2, 3, 4, 5],
      "enumDescriptions": {
        "1": "Строительство",
        "2": "Реконструкция",
        "3": "Капитальный ремонт",
        "4": "Снос",
        "5": "Сохранение объекта культурного наследия"
      },
      "note": "В JSON Schema используется projectType как string, но XSD требует integer enum"
    },
    {
      "section": "generalInfo",
      "field": "functions",
      "xsdPath": "NonIndustrialObject/Functions",
      "type": "object",
      "required": true,
      "description": "Сведения о функциональном назначении объекта",
      "structure": {
        "FunctionsNote": "optional - Функциональное назначение",
        "FunctionsClass": "required - Код по классификатору (tFunctionsClass)",
        "ProductsNote": "optional - Сведения о составе производства"
      }
    },
    {
      "section": "generalInfo",
      "field": "functionsFeatures",
      "xsdPath": "NonIndustrialObject/FunctionsFeatures",
      "type": "string",
      "required": true,
      "description": "Принадлежность к объектам транспортной инфраструктуры",
      "fieldType": "richtext"
    },
    {
      "section": "generalInfo",
      "field": "powerIndicator",
      "xsdPath": "NonIndustrialObject/PowerIndicator",
      "type": "array",
      "required": true,
      "minItems": 1,
      "description": "Данные о проектной мощности объекта (тип tTEI)",
      "structure": {
        "Name": "required - Наименование показателя",
        "Measure": "required - Единица измерения (код ОКЕИ)",
        "Value": "required - Значение",
        "OldValue": "optional - Предыдущее значение (при реконструкции)"
      }
    },
    {
      "section": "generalInfo",
      "field": "energyEfficiency",
      "xsdPath": "NonIndustrialObject/EnergyEfficiency",
      "type": "object",
      "required": true,
      "description": "Сведения о классе энергетической эффективности",
      "structure": {
        "EnergyEfficiencyClass": "required - Класс (tEfficiencyClass)",
        "EnergyEfficiencyImproving": "optional - Сведения о повышении эффективности"
      }
    },
    {
      "section": "generalInfo",
      "field": "fireDangerCategory",
      "xsdPath": "NonIndustrialObject/FireDangerCategory",
      "type": "string",
      "required": true,
      "description": "Категория пожарной и взрывопожарной опасности",
      "enum": ["Категория не устанавливается", "А", "Б", "В", "Г", "Д"]
    },
    {
      "section": "generalInfo",
      "field": "peoplePermanentStay",
      "xsdPath": "NonIndustrialObject/PeoplePermanentStay",
      "type": "string",
      "required": true,
      "description": "Сведения о наличии помещений с постоянным пребыванием людей",
      "fieldType": "richtext"
    },
    {
      "section": "generalInfo",
      "field": "responsibilityLevel",
      "xsdPath": "NonIndustrialObject/ResponsibilityLevel",
      "type": "string",
      "required": true,
      "description": "Уровень ответственности",
      "enum": ["повышенный", "нормальный", "пониженный"]
    },
    {
      "section": "generalInfo",
      "field": "resources",
      "xsdPath": "NonIndustrialObject/Resources",
      "type": "object",
      "required": true,
      "description": "Сведения о потребности объекта в топливе, газе, воде и электрической энергии",
      "structure": {
        "Note": "optional - Общие сведения",
        "Resource": "array - Список ресурсов (Name, Measure, Value, Source, Note)"
      }
    },
    {
      "section": "generalInfo",
      "field": "landCategory",
      "xsdPath": "NonIndustrialObject/LandCategory",
      "type": "string",
      "required": true,
      "maxOccurs": 7,
      "description": "Категория земель (код)",
      "enum": ["1", "2", "3", "4", "5", "6", "7"],
      "enumDescriptions": {
        "1": "Земли сельскохозяйственного назначения",
        "2": "Земли населенных пунктов",
        "3": "Земли промышленности, энергетики, транспорта...",
        "4": "Земли особо охраняемых территорий и объектов",
        "5": "Земли лесного фонда",
        "6": "Земли водного фонда",
        "7": "Земли запаса"
      },
      "note": "XSD использует числовые коды, JSON Schema - текстовые описания"
    },
    {
      "section": "generalInfo",
      "field": "projectDocumentation",
      "xsdPath": "NonIndustrialObject/ProjectDocumentation",
      "type": "object",
      "required": true,
      "description": "Сведения о составе проектной документации объекта (tNonLinearProjectDocumentContent)",
      "note": "Полная структура всех разделов ПД"
    },
    {
      "section": "generalInfo",
      "field": "objectID",
      "xsdPath": "NonIndustrialObject/@ObjectID",
      "type": "string",
      "required": true,
      "description": "Идентификатор объекта (xs:ID attribute)",
      "attribute": true
    },
    {
      "section": "generalInfo",
      "field": "placement",
      "xsdPath": "NonIndustrialObject/@Placement",
      "type": "string",
      "required": true,
      "description": "Сведения о месте расположения объекта",
      "attribute": true,
      "enum": ["1", "2"],
      "enumDescriptions": {
        "1": "Объекты, расположенные на суше",
        "2": "Водный объект"
      }
    },
    {
      "section": "siteInfo",
      "field": "location",
      "xsdPath": "Address (структура)",
      "type": "string",
      "required": false,
      "description": "Местоположение земельного участка",
      "note": "В JSON Schema есть как location (string), но должен быть полноценный Address"
    },
    {
      "section": "climaticConditions",
      "field": "climateDistrict",
      "xsdPath": "ClimateConditions/ClimateDistrict",
      "type": "string",
      "required": false,
      "description": "Климатический район (подрайон)",
      "enum": ["I", "IА", "IБ", "IВ", "IГ", "IД", "II", "IIА", "IIБ", "IIВ", "IIГ", "III", "IIIА", "IIIБ", "IIIВ", "IV", "IVА", "IVБ", "IVВ", "IVГ"],
      "note": "В JSON Schema только climateZone как string, но XSD требует точный код района"
    },
    {
      "section": "climaticConditions",
      "field": "geologicalConditions",
      "xsdPath": "ClimateConditions/GeologicalConditions",
      "type": "string",
      "required": false,
      "description": "Инженерно-геологические условия",
      "enum": ["I", "II", "III"],
      "enumDescriptions": {
        "I": "I (простые)",
        "II": "II (средней сложности)",
        "III": "III (сложные)"
      },
      "note": "В JSON Schema есть geologicalConditions, но без enum"
    },
    {
      "section": "climaticConditions",
      "field": "windDistrict",
      "xsdPath": "ClimateConditions/WindDistrict",
      "type": "string",
      "required": false,
      "description": "Ветровой район",
      "enum": ["Iа", "I", "II", "III", "IV", "V", "VI", "VII"],
      "note": "В JSON Schema windRegion использует другие коды: Ia вместо Iа"
    },
    {
      "section": "climaticConditions",
      "field": "snowDistrict",
      "xsdPath": "ClimateConditions/SnowDistrict",
      "type": "string",
      "required": false,
      "description": "Снеговой район",
      "enum": ["I", "II", "III", "IV", "V", "VI", "VII", "VIII"],
      "note": "В JSON Schema есть snowRegion, соответствие correct"
    },
    {
      "section": "climaticConditions",
      "field": "seismicActivity",
      "xsdPath": "ClimateConditions/SeismicActivity",
      "type": "string",
      "required": false,
      "description": "Интенсивность сейсмических воздействий",
      "enum": ["5", "6", "7", "8", "9", "10"],
      "enumDescriptions": {
        "5": "5 и менее баллов",
        "6": "6",
        "7": "7",
        "8": "8",
        "9": "9",
        "10": "Более 9 баллов"
      },
      "note": "В JSON Schema seismicity использует строки: '6', '7', '8', '9', 'Не требуется учёт'"
    },
    {
      "section": "energyEfficiency",
      "field": "energyEfficiencyClass",
      "xsdPath": "EnergyEfficiency/EnergyEfficiencyClass",
      "type": "string",
      "required": true,
      "description": "Класс энергетической эффективности",
      "enum": ["Не классифицируется", "A++", "A+", "A", "B", "C", "D", "E", "F", "G"],
      "note": "В JSON Schema используется enum: ['A++', 'A+', 'A', 'B', 'B+', 'B-', 'C', 'C+', 'C-', 'D', 'E'] - не соответствует XSD!"
    }
  ],

  "missingEnums": [
    {
      "field": "constructionType",
      "xsd_type": "integer",
      "json_type": "string",
      "issue": "Тип данных не соответствует",
      "xsd_values": [1, 2, 3, 4, 5],
      "json_values": ["Новое строительство", "Реконструкция", "Капитальный ремонт", "Техническое перевооружение"],
      "descriptions": {
        "1": "Строительство",
        "2": "Реконструкция",
        "3": "Капитальный ремонт",
        "4": "Снос",
        "5": "Сохранение объекта культурного наследия"
      },
      "note": "XSD требует числовые коды, JSON использует текст. Нужна конверсия!"
    },
    {
      "field": "landCategory",
      "xsd_type": "string (numeric codes)",
      "json_type": "string (descriptions)",
      "issue": "Разные форматы значений",
      "xsd_values": ["1", "2", "3", "4", "5", "6", "7"],
      "json_values": [
        "Земли населённых пунктов",
        "Земли сельскохозяйственного назначения",
        "Земли промышленности",
        "Земли особо охраняемых территорий",
        "Земли лесного фонда",
        "Земли водного фонда",
        "Земли запаса"
      ],
      "mapping": {
        "1": "Земли сельскохозяйственного назначения",
        "2": "Земли населенных пунктов",
        "3": "Земли промышленности, энергетики, транспорта, связи...",
        "4": "Земли особо охраняемых территорий и объектов",
        "5": "Земли лесного фонда",
        "6": "Земли водного фонда",
        "7": "Земли запаса"
      }
    },
    {
      "field": "energyEfficiencyClass",
      "issue": "Несоответствие значений enum",
      "xsd_values": ["Не классифицируется", "A++", "A+", "A", "B", "C", "D", "E", "F", "G"],
      "json_values": ["A++", "A+", "A", "B", "B+", "B-", "C", "C+", "C-", "D", "E"],
      "missing_in_json": ["Не классифицируется", "F", "G"],
      "extra_in_json": ["B+", "B-", "C+", "C-"]
    },
    {
      "field": "windRegion",
      "issue": "Несоответствие формата",
      "xsd_values": ["Iа", "I", "II", "III", "IV", "V", "VI", "VII"],
      "json_values": ["Ia", "I", "II", "III", "IV", "V", "VI", "VII"],
      "note": "Ia вместо Iа (латиница vs кириллица)"
    },
    {
      "field": "seismicity",
      "issue": "Частичное несоответствие значений",
      "xsd_values": ["5", "6", "7", "8", "9", "10"],
      "xsd_descriptions": {
        "5": "5 и менее баллов",
        "10": "Более 9 баллов"
      },
      "json_values": ["6", "7", "8", "9", "Не требуется учёт"],
      "missing_in_json": ["5", "10"],
      "extra_in_json": ["Не требуется учёт"]
    },
    {
      "field": "climateDistrict",
      "xsd_values": [
        "I", "IА", "IБ", "IВ", "IГ", "IД",
        "II", "IIА", "IIБ", "IIВ", "IIГ",
        "III", "IIIА", "IIIБ", "IIIВ",
        "IV", "IVА", "IVБ", "IVВ", "IVГ"
      ],
      "json_field": "climateZone",
      "json_type": "string (free text)",
      "issue": "В JSON Schema нет enum для климатического района, только maxLength: 100"
    },
    {
      "field": "geologicalConditions",
      "xsd_values": ["I", "II", "III"],
      "xsd_descriptions": {
        "I": "I (простые)",
        "II": "II (средней сложности)",
        "III": "III (сложные)"
      },
      "json_field": "geologicalConditions",
      "json_type": "string (free text with richtext)",
      "issue": "В JSON Schema нет enum, используется свободный текст"
    }
  ],

  "structuralDifferences": [
    {
      "issue": "Отсутствует корневой уровень ExplanatoryNote",
      "description": "В XSD корневой элемент ExplanatoryNote содержит метаданные о документе (номер, год, авторы, подписанты). В JSON Schema корневым является generalInfo.",
      "impact": "critical",
      "xsd_structure": "ExplanatoryNote -> NonIndustrialObject -> (fields)",
      "json_structure": "{ generalInfo: {}, siteInfo: {}, ... }",
      "recommendation": "Добавить обертку верхнего уровня с метаданными документа"
    },
    {
      "issue": "customerInfo vs Developer/TechnicalCustomer",
      "description": "В JSON Schema customerInfo - это один объект с ИНН/ОГРН. В XSD это Developer (застройщик) или TechnicalCustomer (технический заказчик) с выбором типа: Organization/ForeignOrganization/IP/Person",
      "impact": "high",
      "recommendation": "Расширить customerInfo для поддержки разных типов юридических лиц"
    },
    {
      "issue": "designerInfo vs IssueAuthor + ProjectDocumentationAuthors",
      "description": "В XSD разделены генеральный проектировщик (IssueAuthor) и субпроектировщики (ProjectDocumentationAuthors)",
      "impact": "medium",
      "recommendation": "Разделить на issueAuthor и projectDocumentationAuthors"
    },
    {
      "issue": "Address структура",
      "description": "В XSD Address - это сложный тип с Region (код субъекта РФ обязателен), District, City, Settlement, Street и т.д. В JSON Schema используется простая строка.",
      "impact": "high",
      "recommendation": "Использовать структурированный объект для адреса с кодом региона"
    },
    {
      "issue": "Атрибуты ObjectID, Placement, DangerousAndComplex, Unique",
      "description": "В XSD объект имеет обязательные атрибуты ObjectID и Placement, опциональные DangerousAndComplex и Unique",
      "impact": "medium",
      "recommendation": "Добавить эти поля в JSON Schema"
    },
    {
      "issue": "Functions - FunctionsClass обязателен",
      "description": "В XSD Functions.FunctionsClass (код по классификатору) обязателен. В JSON нет.",
      "impact": "high",
      "recommendation": "Добавить functionsClass как обязательное поле с типом tFunctionsClass"
    },
    {
      "issue": "PowerIndicator vs TEI",
      "description": "В XSD PowerIndicator (показатели мощности) обязателен (minOccurs=1), TEI (прочие ТЭП) опционален. В JSON все в одном разделе economicIndicators.",
      "impact": "medium",
      "recommendation": "Разделить на powerIndicators (обязательно) и technicalEconomicIndicators (опционально)"
    },
    {
      "issue": "Отсутствуют поля для производственных объектов",
      "description": "XSD поддерживает 3 типа объектов: NonIndustrialObject, IndustrialObject, LinearObject. JSON Schema ориентирована только на непроизводственные.",
      "impact": "critical",
      "recommendation": "Добавить поддержку IndustrialObject и LinearObject с их специфическими полями (RawResources, ResourceUseInfo, DangerousIndustrialObject, LinearObjectCategory, LinearObjectClass)"
    },
    {
      "issue": "Отсутствует структура ProjectDocumentation",
      "description": "В XSD есть полная структура всех разделов ПД (Section1-Section13 для нелинейных, Section2-Section10 для линейных). В JSON нет.",
      "impact": "high",
      "recommendation": "Добавить структуру разделов проектной документации"
    },
    {
      "issue": "Отсутствуют поля Signers",
      "description": "В XSD обязательный элемент Signers с ChiefProjectEngineer (обязателен), ChiefProjectArchitect (опционален) и массивом Signer",
      "impact": "high",
      "recommendation": "Добавить раздел signers с главным инженером проекта (СНИЛС, номер НОПРИЗ)"
    }
  ],

  "summary": {
    "totalXSDRequiredFields": 45,
    "currentJSONFields": 87,
    "criticalMissing": 18,
    "mediumImpact": 15,
    "lowImpact": 12,
    "enumMismatches": 7,
    "structuralIssues": 10,
    "overallCompliance": "~35%",
    "notes": [
      "JSON Schema более детальна в разделах инженерных систем и конструктивных решений",
      "XSD более строгая в метаданных документа и административных данных",
      "Критически не хватает верхнего уровня ExplanatoryNote с метаданными",
      "Типы данных enum часто не совпадают (числовые коды vs текстовые описания)",
      "XSD требует поддержки 3 типов объектов, JSON покрывает только 1",
      "Отсутствует структура разделов проектной документации",
      "Отсутствуют обязательные подписи (ГИП, ГАП)",
      "Address должен быть структурированным объектом, а не строкой"
    ]
  },

  "recommendations": {
    "priority_1_critical": [
      "Добавить корневой уровень ExplanatoryNote с метаданными (ExplanatoryNoteNumber, ExplanatoryNoteYear, SchemaVersion)",
      "Добавить IssueAuthor (генеральный проектировщик)",
      "Добавить Signers с ChiefProjectEngineer (обязательно)",
      "Добавить Developer/TechnicalCustomer с типом организации",
      "Исправить Address - сделать структурированным объектом",
      "Добавить Functions.FunctionsClass (код по классификатору)",
      "Исправить constructionType - использовать числовые коды вместо текста",
      "Добавить обязательные атрибуты ObjectID и Placement",
      "Добавить поддержку IndustrialObject и LinearObject"
    ],
    "priority_2_high": [
      "Добавить ProjectDecisionDocuments и ProjectInitialDocuments",
      "Добавить DesignerAssurance (заверение проектной организации)",
      "Добавить FireDangerCategory, PeoplePermanentStay, ResponsibilityLevel",
      "Добавить PowerIndicator как отдельный обязательный массив",
      "Добавить структуру ProjectDocumentation с разделами ПД",
      "Исправить landCategory - использовать числовые коды",
      "Добавить Resources как обязательное поле с массивом ресурсов"
    ],
    "priority_3_medium": [
      "Исправить enum для energyEfficiencyClass (добавить 'Не классифицируется', 'F', 'G')",
      "Исправить enum для windRegion (Iа вместо Ia)",
      "Добавить enum для climateDistrict",
      "Добавить enum для geologicalConditions",
      "Исправить seismicity enum (добавить '5', '10', убрать 'Не требуется учёт')",
      "Добавить UsedNorms (перечень нормативных документов)",
      "Добавить FunctionsFeatures (принадлежность к транспортной инфраструктуре)"
    ],
    "data_migration": [
      "Создать mapping для constructionType: текст -> число",
      "Создать mapping для landCategory: текст -> код",
      "Реструктурировать address из строки в объект",
      "Разделить customerInfo на developer/technicalCustomer",
      "Переименовать projectType в constructionType с изменением типа"
    ]
  },

  "validation_rules": {
    "xsd_specific": [
      "SchemaVersion attribute must be '01.05'",
      "ExplanatoryNoteNumber is required (non-empty-string)",
      "ExplanatoryNoteYear is required (tYear: 4-digit year)",
      "At least one Developer or TechnicalCustomer is required",
      "ChiefProjectEngineer in Signers is required",
      "Address.Region (code of RF subject) is required",
      "Functions.FunctionsClass (classifier code) is required",
      "PowerIndicator array must have at least 1 item",
      "EnergyEfficiency is required for NonIndustrialObject",
      "LandCategory can appear 1-7 times (unique values)",
      "ObjectID attribute is required and must be unique (xs:ID type)",
      "Placement attribute is required (1=land, 2=water)"
    ],
    "enum_validations": [
      "ConstructionType must be 1-5 (integer)",
      "LandCategory must be '1'-'7' (string)",
      "EnergyEfficiencyClass must match tEfficiencyClass enum",
      "ResponsibilityLevel must be: повышенный|нормальный|пониженный",
      "FireDangerCategory must be: Категория не устанавливается|А|Б|В|Г|Д",
      "WindDistrict must match tWindDistrict enum (Iа-VII)",
      "SnowDistrict must match tSnowDistrict enum (I-VIII)",
      "SeismicActivity must be '5','6','7','8','9','10'"
    ]
  }
}
